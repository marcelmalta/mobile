<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Novo An√∫ncio ‚Äî Sellulares.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { scroll-behavior: smooth; }
    ::-webkit-scrollbar { height:6px; width:6px; }
    ::-webkit-scrollbar-thumb { background:#ccc; border-radius:10px; }
    @keyframes mlBarPulse {
      0%,100% { box-shadow:0 0 8px rgba(250,204,21,.4), inset 0 0 6px rgba(250,204,21,.3); }
      50% { box-shadow:0 0 16px rgba(250,204,21,.8), inset 0 0 8px rgba(250,204,21,.6); }
    }
    .animate-ml-bar { animation: mlBarPulse 2.8s infinite ease-in-out; }
    .etapa-pill {
      display:flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px;
      background:linear-gradient(145deg,#f8fafc,#e2e8f0);
      border:1px solid rgba(148,163,184,.4);
      font-size:13px; font-weight:600; color:#1f2937;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.6);
    }
    .input-base{
      width:100%; border-radius:12px;
      border:1px solid rgba(148,163,184,.6);
      background:#fff; padding:10px 14px;
      font-size:14px; color:#1f2937;
      box-shadow:inset 0 1px 2px rgba(148,163,184,.25);
      transition:border .2s ease, box-shadow .2s ease;
    }
    .input-base:focus{
      outline:none;
      border-color:#fbbf24;
      box-shadow:0 0 0 3px rgba(251,191,36,.25);
    }
    .pill-option{
      display:flex; align-items:center; gap:8px;
      padding:9px 14px; border-radius:9999px;
      border:1.5px solid rgba(209,213,219,.9);
      background:#ffffff;
      font-weight:600; font-size:13px;
      color:#1f2937; transition:.25s ease;
      box-shadow:0 2px 6px rgba(15,23,42,.08);
    }
    .pill-option:hover{
      border-color:rgba(251,191,36,.7);
      color:#b45309;
      box-shadow:0 4px 12px rgba(250,204,21,.18);
    }
    .pill-option input{ accent-color:#facc15; }
    .callout{
      background:linear-gradient(120deg,rgba(255,241,89,.35),rgba(255,255,255,.6));
      border:1px solid rgba(250,204,21,.45);
      color:#78350f;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

  <!-- HEADER -->
  <header class="sticky top-0 z-50 shadow-md">
    <div class="bg-gray-900 text-gray-200 text-[10px] flex justify-center gap-4 py-0.5 font-medium">
      <span class="flex items-center gap-1"><span>üõ°Ô∏è</span><span>Site Seguro</span></span>
      <span class="flex items-center gap-1"><span>‚≠ê</span><span>Melhores Lojas do Brasil</span></span>
      <span class="flex items-center gap-1"><span>üöÄ</span><span>Ofertas Verificadas</span></span>
    </div>
    <div class="bg-black px-2 py-1 sm:py-2 flex flex-col sm:flex-row items-center justify-between">
      <div class="flex justify-center sm:justify-start">
        <img src="banner-sellulares-desktop.png" alt="Sellulares.com" class="hidden sm:block w-[70%] max-h-[70px] object-contain animate-fade-in">
        <img src="banner-sellulares-mobile.png" alt="Sellulares.com" class="block sm:hidden w-[85%] max-h-[60px] object-contain animate-fade-in">
      </div>
      <a href="index.html" class="hidden sm:inline-flex items-center justify-center px-3 py-2 bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-900 font-bold text-[13px] rounded-full hover:from-yellow-500 hover:to-yellow-600 shadow-md hover:shadow-lg transition-all whitespace-nowrap">
        ‚Üê Voltar √†s ofertas
      </a>
    </div>
  </header>

  <!-- SELO DE CONFIAN√áA MULTIMARCAS -->
  <section class="ml-selo relative overflow-hidden bg-gradient-to-r from-[#fff159] via-[#b3e5fc] to-[#ffecb3] text-gray-900 py-2 px-3 flex items-center justify-center border-b border-yellow-300 shadow animate-ml-bar">
    <div class="flex flex-wrap items-center gap-3 sm:gap-5 z-10 relative">
      <div class="flex items-center gap-1">
        <img src="https://http2.mlstatic.com/frontend-assets/ml-web-navigation/ui-navigation/5.23.1/mercadolibre/logo__small.png"
             alt="Mercado Livre" class="h-5 sm:h-6 drop-shadow-md">
        <span class="text-[11px] sm:text-sm font-bold text-[#3483fa]">Mercado Livre</span>
      </div>
      <div class="flex items-center gap-1">
        <img src="https://mvc.mlcdn.com.br/magazinevoce/img/common/influenciador-magalu-logo-blue.svg"
             alt="Magazine Luiza" class="h-5 sm:h-6 drop-shadow-md">
        <span class="text-[11px] sm:text-sm font-bold text-blue-600">Magalu</span>
      </div>
      <div class="flex items-center gap-1">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg"
             alt="Amazon" class="h-5 sm:h-6 drop-shadow-md">
        <span class="text-[11px] sm:text-sm font-bold text-orange-500">Amazon</span>
      </div>
      <span class="text-[12px] sm:text-base font-extrabold text-gray-800 ml-2">üåü Publie com a mesma seguran√ßa da nossa vitrine principal</span>
    </div>
  </section>

  <main class="max-w-5xl mx-auto px-3 sm:px-6 py-6 sm:py-10 space-y-6">
    <div class="callout rounded-2xl px-4 py-3 shadow-sm text-sm sm:text-base flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
      <span class="font-semibold flex items-center gap-2">
        <span>üìù</span>
        <span>Preencha os dados abaixo para validar o an√∫ncio antes de envi√°-lo √† vitrine.</span>
      </span>
      <a href="index.html" class="inline-flex sm:hidden items-center justify-center px-3 py-1.5 bg-black text-yellow-400 font-semibold rounded-full text-xs uppercase tracking-wide">
        Voltar √†s ofertas
      </a>
    </div>

    <section class="relative bg-white/95 backdrop-blur rounded-3xl shadow-xl border border-gray-200/80 p-5 sm:p-8">
      <div class="absolute inset-0 rounded-3xl pointer-events-none" style="background:linear-gradient(135deg,rgba(255,241,89,0.16),rgba(59,130,246,0.08)); opacity:0.35;"></div>
      <div class="relative z-10 space-y-6">
        <div>
          <h2 class="text-xl sm:text-2xl font-extrabold text-gray-900">üì¢ Publicar novo an√∫ncio</h2>
          <p class="mt-2 text-sm text-gray-600 leading-relaxed">
            Informe as caracter√≠sticas do aparelho, as condi√ß√µes de venda e os dados de contato. O JSON final pode ser copiado para o <code>script.js</code> ou enviado diretamente pelo painel administrativo.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-[12px] text-gray-700">
          <div class="etapa-pill"><strong class="text-yellow-600">1.</strong><span>Produto</span></div>
          <div class="etapa-pill"><strong class="text-yellow-600">2.</strong><span>Pre√ßo &amp; Pagamento</span></div>
          <div class="etapa-pill"><strong class="text-yellow-600">3.</strong><span>Entrega &amp; Contato</span></div>
        </div>

        <form id="anuncioForm" class="relative grid gap-6">

          <!-- PRODUTO -->
          <div class="grid gap-4">
            <div>
              <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Nome do aparelho *</label>
              <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <input id="nome" list="listaAparelhos" required
                       class="input-base"
                       placeholder="Ex.: Samsung Galaxy S23 256GB" />
                <input id="modeloOutro"
                       class="input-base"
                       placeholder="Outro modelo (opcional)" />
              </div>
              <datalist id="listaAparelhos">
                <option>Apple iPhone 11 64GB</option>
                <option>Apple iPhone 12 128GB</option>
                <option>Apple iPhone 13 128GB</option>
                <option>Apple iPhone 14 128GB</option>
                <option>Apple iPhone 15 128GB</option>
                <option>Apple iPhone 16 128GB</option>
                <option>Samsung Galaxy S21 128GB</option>
                <option>Samsung Galaxy S22 256GB</option>
                <option>Samsung Galaxy S23 256GB</option>
                <option>Samsung Galaxy S24 256GB</option>
                <option>Samsung Galaxy A15 128GB</option>
                <option>Samsung Galaxy A34 128GB</option>
                <option>Samsung Galaxy A35 128GB</option>
                <option>Motorola Moto G54 256GB</option>
                <option>Motorola Moto G84 256GB</option>
                <option>Motorola Edge 40 256GB</option>
                <option>Xiaomi Redmi Note 13 128GB</option>
                <option>Xiaomi Redmi Note 13 Pro 256GB</option>
                <option>POCO X6 Pro 256GB</option>
                <option>POCO X7 Pro 512GB</option>
                <option>Realme 12 256GB</option>
                <option>Realme 12 Pro+ 256GB</option>
              </datalist>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <label class="flex flex-col gap-1">
                <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Condi√ß√£o</span>
                <select id="condicao" class="input-base">
                  <option value="">Selecione</option>
                  <option value="Novo">Novo</option>
                  <option value="Seminovo">Seminovo</option>
                  <option value="Usado">Usado</option>
                </select>
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Nota fiscal</span>
                <select id="notaFiscal" class="input-base">
                  <option value="">Selecione</option>
                  <option value="Sim">Sim</option>
                  <option value="N√£o">N√£o</option>
                </select>
              </label>
            </div>
          </div>

          <!-- PRE√áO & PAGAMENTO -->
          <div class="grid gap-4">
            <div class="rounded-2xl border border-yellow-300/70 bg-gradient-to-br from-yellow-50 via-white to-white p-5 shadow-inner">
              <label class="block text-sm font-extrabold text-yellow-600 tracking-wide mb-2 uppercase">üí∞ Pre√ßo atual *</label>
              <div class="flex items-center gap-3">
                <span class="text-yellow-500 text-2xl font-black">R$</span>
                <input id="precoAtual" type="number" required min="0" step="0.01"
                       class="input-base text-lg font-bold border-2 border-yellow-300/70 focus:border-yellow-400 focus:ring-0"
                       placeholder="Ex.: 3599.00" />
              </div>
              <p class="text-[12px] text-gray-600 mt-2">Informe o valor √† vista ou o pre√ßo inicial para negocia√ß√£o.</p>
            </div>

            <div>
              <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Formas de pagamento aceitas *</label>
              <div class="flex flex-wrap gap-2 mt-3">
                <label class="pill-option">
                  <input type="checkbox" name="pagamento" value="PIX">
                  <span>PIX</span>
                </label>
                <label class="pill-option">
                  <input type="checkbox" name="pagamento" value="Cart√£o">
                  <span>Cart√£o de cr√©dito</span>
                </label>
                <label class="pill-option">
                  <input type="checkbox" name="pagamento" value="Dinheiro">
                  <span>Dinheiro</span>
                </label>
              </div>
            </div>
          </div>

          <!-- LOCAL & ENTREGA -->
          <div class="grid gap-4">
            <div>
              <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Local (Cidade - UF) *</label>
              <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <select id="uf" class="input-base" required>
                  <option value="">Selecione o estado</option>
                  <option value="AC">Acre (AC)</option>
                  <option value="AL">Alagoas (AL)</option>
                  <option value="AP">Amap√° (AP)</option>
                  <option value="AM">Amazonas (AM)</option>
                  <option value="BA">Bahia (BA)</option>
                  <option value="CE">Cear√° (CE)</option>
                  <option value="DF">Distrito Federal (DF)</option>
                  <option value="ES">Esp√≠rito Santo (ES)</option>
                  <option value="GO">Goi√°s (GO)</option>
                  <option value="MA">Maranh√£o (MA)</option>
                  <option value="MT">Mato Grosso (MT)</option>
                  <option value="MS">Mato Grosso do Sul (MS)</option>
                  <option value="MG">Minas Gerais (MG)</option>
                  <option value="PA">Par√° (PA)</option>
                  <option value="PB">Para√≠ba (PB)</option>
                  <option value="PR">Paran√° (PR)</option>
                  <option value="PE">Pernambuco (PE)</option>
                  <option value="PI">Piau√≠ (PI)</option>
                  <option value="RJ">Rio de Janeiro (RJ)</option>
                  <option value="RN">Rio Grande do Norte (RN)</option>
                  <option value="RS">Rio Grande do Sul (RS)</option>
                  <option value="RO">Rond√¥nia (RO)</option>
                  <option value="RR">Roraima (RR)</option>
                  <option value="SC">Santa Catarina (SC)</option>
                  <option value="SP">S√£o Paulo (SP)</option>
                  <option value="SE">Sergipe (SE)</option>
                  <option value="TO">Tocantins (TO)</option>
                </select>
                <input id="cidade" list="listaCidades"
                       class="input-base"
                       placeholder="Digite ou selecione a cidade" required />
              </div>
              <datalist id="listaCidades"></datalist>
            </div>

            <div>
              <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Tipo de entrega *</label>
              <div class="flex flex-wrap gap-2 mt-3">
                <label class="pill-option">
                  <input type="checkbox" name="entregaTipo" value="Encontro p√∫blico">
                  <span>Encontro p√∫blico</span>
                </label>
                <label class="pill-option">
                  <input type="checkbox" name="entregaTipo" value="Entrega">
                  <span>Entrega</span>
                </label>
                <label class="pill-option">
                  <input type="checkbox" name="entregaTipo" value="Retirada">
                  <span>Retirada</span>
                </label>
              </div>
            </div>
          </div>

          <!-- IMAGEM & DESCRI√á√ÉO -->
          <div class="grid gap-4">
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Imagem (arquivo) *</span>
              <input id="imagemFile" type="file" accept="image/*"
                     class="input-base mt-2" required />
              <div id="previewWrap" class="mt-2 hidden">
                <p class="text-xs text-gray-500 mb-1">Preview:</p>
                <img id="preview" class="w-36 h-36 object-cover rounded-lg border border-gray-200 shadow-sm" alt="preview" />
              </div>
            </div>

            <label class="flex flex-col gap-1">
              <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Descri√ß√£o curta</span>
              <textarea id="descricao" rows="3"
                        class="input-base resize-y min-h-[90px]"
                        placeholder="Condi√ß√£o, acess√≥rios, nota fiscal, etc."></textarea>
            </label>
          </div>

          <!-- CONTATO -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <label class="flex flex-col gap-1">
              <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Contato WhatsApp *</span>
              <input id="contato" required
                     class="input-base"
                     placeholder="Ex.: https://wa.me/5581999999999" />
            </label>
            <label class="flex flex-col gap-1">
              <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Quantidade</span>
              <input id="estoque" type="number" min="1" step="1"
                     class="input-base"
                     value="1" />
            </label>
          </div>

          <!-- A√á√ïES -->
          <div class="flex flex-wrap gap-2 mt-1">
            <button id="btnUpload" type="button"
                    class="bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-400 text-gray-900 font-bold px-6 py-2.5 rounded-full shadow-md hover:from-yellow-500 hover:to-yellow-500 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-300">
              üì§ Enviar an√∫ncio
            </button>
            <button id="btnSimular" type="button"
                    class="px-5 py-2.5 rounded-full border border-gray-300 bg-white font-semibold text-gray-700 shadow-sm hover:border-yellow-400 hover:text-yellow-600 transition-all">
              ‚ö†Ô∏è Simular
            </button>
            <a id="btnVoltar" class="ml-auto text-sm text-yellow-600 font-semibold hover:underline" href="index.html">‚Üê Voltar √† home</a>
          </div>

          <!-- CONFIRMA√á√ÉO -->
          <div id="confirmacaoPublica" class="mt-4 hidden">
            <div class="rounded-xl border border-emerald-300 bg-emerald-50 text-emerald-700 px-4 py-3 text-sm shadow-sm">
              ‚úÖ Seu an√∫ncio foi enviado com sucesso e ser√° analisado em breve. Obrigado!
            </div>
          </div>

          <!-- √ÅREA ADMIN -->
          <div id="resultado" class="mt-4 hidden">
            <h3 class="font-semibold text-gray-800 mb-2 flex items-center gap-2 text-sm">
              <span>üîê JSON gerado (admin)</span><span class="text-gray-400 font-normal">‚Äî cole diretamente no <code>script.js</code></span>
            </h3>
            <textarea id="jsonOutput" rows="10"
                      class="w-full rounded-2xl border border-gray-300 bg-gray-50 text-gray-800 font-mono text-sm p-3 shadow-inner"></textarea>
            <div class="flex gap-2 mt-3">
              <button id="copiar" class="px-4 py-2 rounded-full bg-emerald-500 hover:bg-emerald-400 text-white font-semibold shadow-sm transition">üìã Copiar</button>
              <button id="abrirPreview" class="px-4 py-2 rounded-full bg-indigo-500 hover:bg-indigo-400 text-white font-semibold shadow-sm transition">üîé Preview</button>
            </div>
            <p class="text-xs text-gray-500 mt-2">Dica: o JSON tamb√©m √© exibido no console (DevTools).</p>
          </div>

          <div id="msg" class="mt-2 text-sm text-gray-600 font-semibold"></div>
        </form>
      </div>
    </section>
  </main>

  <script>
    // ====== Flags ======
    const params = new URLSearchParams(location.search);
    const authToken = params.get('auth') || '';
    const isAdmin = params.get('admin') === '1';

    // ====== Refs ======
    const inputFile = document.getElementById('imagemFile');
    const previewWrap = document.getElementById('previewWrap');
    const preview = document.getElementById('preview');
    const btnUpload = document.getElementById('btnUpload');
    const btnSimular = document.getElementById('btnSimular');
    const confirmacaoPublica = document.getElementById('confirmacaoPublica');
    const resultado = document.getElementById('resultado');
    const jsonOutput = document.getElementById('jsonOutput');
    const copiar = document.getElementById('copiar');
    const abrirPreview = document.getElementById('abrirPreview');
    const msg = document.getElementById('msg');

    const nomeEl = document.getElementById('nome');
    const modeloOutroEl = document.getElementById('modeloOutro');
    const ufEl = document.getElementById('uf');
    const cidadeEl = document.getElementById('cidade');
    const listaCidades = document.getElementById('listaCidades');

    // ====== CIDADES por UF (sugest√µes; usu√°rio pode digitar outra) ======
    const cidadesPorUF = {
      "AC": ["Rio Branco", "Cruzeiro do Sul", "Sena Madureira"],
      "AL": ["Macei√≥", "Arapiraca", "Palmeira dos √çndios"],
      "AP": ["Macap√°", "Santana", "Laranjal do Jari"],
      "AM": ["Manaus", "Itacoatiara", "Parintins"],
      "BA": ["Salvador", "Feira de Santana", "Vit√≥ria da Conquista", "Cama√ßari"],
      "CE": ["Fortaleza", "Caucaia", "Juazeiro do Norte", "Maracana√∫", "Sobral"],
      "DF": ["Bras√≠lia", "Taguatinga", "Ceil√¢ndia", "√Åguas Claras", "Gama"],
      "ES": ["Vit√≥ria", "Vila Velha", "Serra", "Cariacica"],
      "GO": ["Goi√¢nia", "Aparecida de Goi√¢nia", "An√°polis"],
      "MA": ["S√£o Lu√≠s", "Imperatriz", "Caxias"],
      "MT": ["Cuiab√°", "V√°rzea Grande", "Rondon√≥polis"],
      "MS": ["Campo Grande", "Dourados", "Tr√™s Lagoas"],
      "MG": ["Belo Horizonte", "Contagem", "Uberl√¢ndia", "Juiz de Fora", "Betim"],
      "PA": ["Bel√©m", "Ananindeua", "Santar√©m"],
      "PB": ["Jo√£o Pessoa", "Campina Grande", "Patos"],
      "PR": ["Curitiba", "Londrina", "Maring√°", "Ponta Grossa", "Cascavel"],
      "PE": ["Recife", "Olinda", "Jaboat√£o dos Guararapes", "Caruaru", "Petrolina"],
      "PI": ["Teresina", "Parna√≠ba", "Picos"],
      "RJ": ["Rio de Janeiro", "Niter√≥i", "Duque de Caxias", "Nova Igua√ßu", "Campos dos Goytacazes"],
      "RN": ["Natal", "Mossor√≥", "Parnamirim"],
      "RS": ["Porto Alegre", "Caxias do Sul", "Pelotas", "Canoas", "Santa Maria"],
      "RO": ["Porto Velho", "Ji-Paran√°", "Ariquemes"],
      "RR": ["Boa Vista", "Rorain√≥polis", "Cant√°"],
      "SC": ["Florian√≥polis", "Joinville", "Blumenau", "Itaja√≠", "Chapec√≥"],
      "SP": ["S√£o Paulo", "Campinas", "Santos", "S√£o Jos√© dos Campos", "Ribeir√£o Preto"],
      "SE": ["Aracaju", "Nossa Senhora do Socorro", "Lagarto"],
      "TO": ["Palmas", "Aragua√≠na", "Gurupi"]
    };

    function atualizarCidadesUF() {
      const uf = ufEl.value;
      const cidades = cidadesPorUF[uf] || [];
      listaCidades.innerHTML = '';
      cidades.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        listaCidades.appendChild(opt);
      });
      cidadeEl.value = '';
      cidadeEl.placeholder = cidades.length ? "Digite ou selecione a cidade" : "Digite sua cidade";
    }
    ufEl.addEventListener('change', atualizarCidadesUF);

    // ====== Preview imagem ======
    inputFile.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) { previewWrap.classList.add('hidden'); return; }
      const url = URL.createObjectURL(f);
      preview.src = url;
      previewWrap.classList.remove('hidden');
    });

    // ====== Normalizar Whats ======
    function normalizarWhats(v) {
      if (!v) return "";
      const clean = v.replace(/[^\d]/g, "");
      if (v.startsWith("http")) return v;
      if (clean.length >= 10) return `https://wa.me/${clean}`;
      return v;
    }

    // ====== JSON ======
    function montarJSON(urlImagem) {
      const nome = (modeloOutroEl.value.trim() || nomeEl.value.trim());
      const precoAtual = Number(document.getElementById('precoAtual').value) || 0;
      const condicao = document.getElementById('condicao').value;
      const notaFiscal = document.getElementById('notaFiscal').value;

      const pagamentos = Array.from(document.querySelectorAll('input[name="pagamento"]:checked')).map(e => e.value);
      const entregas = Array.from(document.querySelectorAll('input[name="entregaTipo"]:checked')).map(e => e.value);

      const uf = ufEl.value;
      const cidade = cidadeEl.value.trim();
      const local = (cidade && uf) ? `${cidade} - ${uf}` : (cidade || uf || '');

      const contatoRaw = document.getElementById('contato').value.trim();
      const contato = normalizarWhats(contatoRaw);

      const estoque = Number(document.getElementById('estoque').value) || 1;
      const descricao = document.getElementById('descricao').value.trim();

      const obj = {
        nome,
        precoAntigo: 0,
        precoAtual,
        desconto: "",
        parcelas: "",
        imagem: urlImagem,
        link: "",
        estoque,
        estoqueTotal: estoque,
        local,
        contato,
        descricao,
        condicao,
        notaFiscal,
        entregas,
        pagamentos
      };
      return obj;
    }

    // ====== Upload real para /upload ======
    async function enviarUploadEGerarJSON() {
      const nome = (modeloOutroEl.value.trim() || nomeEl.value.trim());
      const precoAtual = document.getElementById('precoAtual').value.trim();
      if (!nome || !precoAtual) { msg.textContent = 'Informe o nome e o pre√ßo atual.'; return; }

      if (!ufEl.value || !cidadeEl.value.trim()) {
        msg.textContent = 'Selecione o estado (UF) e a cidade.';
        return;
      }

      const temEntrega = document.querySelectorAll('input[name="entregaTipo"]:checked').length > 0;
      if (!temEntrega) { msg.textContent = 'Selecione pelo menos um tipo de entrega.'; return; }

      const temPagamento = document.querySelectorAll('input[name="pagamento"]:checked').length > 0;
      if (!temPagamento) { msg.textContent = 'Selecione pelo menos uma forma de pagamento.'; return; }

      const file = inputFile.files[0];
      if (!file) { msg.textContent = 'Selecione uma imagem.'; return; }

      const fd = new FormData();
      fd.append('file', file);

      const headers = {};
      if (authToken) headers['x-auth-token'] = authToken;

      msg.textContent = '‚è≥ Enviando imagem...';
      try {
        const UPLOAD_URL = '/upload';

        const res = await fetch(UPLOAD_URL, {
          method: 'POST',
          body: fd,
          headers
        });

        if (!res.ok) {
          const text = await res.text().catch(()=>null);
          throw new Error(text || ('Upload falhou: ' + res.status));
        }

        const data = await res.json();
        if (!data.url) throw new Error('Resposta inv√°lida do servidor: falta url');

        const obj = montarJSON(data.url);
        console.log('[NOVO AN√öNCIO GERADO]', obj);
        msg.textContent = '';
        confirmacaoPublica.classList.remove('hidden');

        if (isAdmin) {
          jsonOutput.value = JSON.stringify(obj, null, 2);
          resultado.classList.remove('hidden');
          window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
      } catch (err) {
        console.error(err);
        msg.textContent = '‚ö†Ô∏è Erro no upload: ' + (err.message || err);
      }
    }

    // ====== Simular sem backend ======
    function simularGeracao() {
      msg.textContent = '';
      const file = inputFile.files[0];
      if (!file) { msg.textContent = 'Selecione uma imagem para simular.'; return; }
      const fakeUrl = URL.createObjectURL(file);
      const obj = montarJSON(fakeUrl);
      console.log('[NOVO AN√öNCIO (SIMULA√á√ÉO)]', obj);
      confirmacaoPublica.classList.remove('hidden');
      if (isAdmin) {
        jsonOutput.value = JSON.stringify(obj, null, 2);
        resultado.classList.remove('hidden');
      }
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // ====== Eventos ======
    document.getElementById('btnUpload').addEventListener('click', enviarUploadEGerarJSON);
    document.getElementById('btnSimular').addEventListener('click', simularGeracao);

    inputFile.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) { previewWrap.classList.add('hidden'); return; }
      const url = URL.createObjectURL(f);
      preview.src = url;
      previewWrap.classList.remove('hidden');
    });

    copiar?.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(jsonOutput.value);
        msg.textContent = 'üìã JSON copiado para a √°rea de transfer√™ncia!';
      } catch (e) {
        msg.textContent = '‚ö†Ô∏è N√£o foi poss√≠vel copiar automaticamente. Selecione e copie manualmente.';
      }
    });

    abrirPreview?.addEventListener('click', () => {
      try {
        const obj = JSON.parse(jsonOutput.value);
        const win = window.open('', '_blank');
        win.document.write(`
          <html><head><title>Preview - ${obj.nome}</title>
          <meta name="viewport" content="width=device-width,initial-scale=1"></head>
          <body style="font-family:Arial;padding:20px;background:#111;color:#eee">
            <h2>${obj.nome}</h2>
            <img src="${obj.imagem}" style="max-width:300px;border:1px solid #333;border-radius:8px">
            <p><strong>Pre√ßo:</strong> R$ ${obj.precoAtual}</p>
            <p><strong>Condi√ß√£o:</strong> ${obj.condicao || '-'}</p>
            <p><strong>Nota fiscal:</strong> ${obj.notaFiscal || '-'}</p>
            <p><strong>Pagamentos:</strong> ${(obj.pagamentos||[]).join(', ') || '-'}</p>
            <p><strong>Entrega:</strong> ${(obj.entregas||[]).join(', ') || '-'}</p>
            <p><strong>Local:</strong> ${obj.local || '-'}</p>
            <p><strong>Contato:</strong> ${obj.contato || '-'}</p>
            <p>${obj.descricao || ''}</p>
          </body></html>
        `);
      } catch (e) {
        msg.textContent = 'JSON inv√°lido.';
      }
    });

    function initAdminBlock() {
      if (isAdmin) {
        // Espa√ßo reservado para futuros ajustes administrativos.
      }
    }
    initAdminBlock();
  </script>
</body>
</html>
